doctype html
html(lang="vi")
  head
    meta(charset="UTF-8")
    link(rel="stylesheet", href="/css/login.css")

    title Đăng nhập
  body
    h2 Đăng nhập
    form(id="loginForm")
      label(for="username") Tên đăng nhập:
      input(type="text" name="username" required)
      br
      label(for="password") Mật khẩu:
      input(type="password" name="password" required)
      br
      button(type="submit") Đăng nhập
    br
    button(id="signupBtn" type="button") Đăng ký tài khoản mới
    p(id="errorMessage" style="color:red")

    script.
      const form = document.getElementById('loginForm');
      const errorMessage = document.getElementById('errorMessage');
      const signupBtn = document.getElementById('signupBtn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();// Ngăn chặn hành vi form reload

        const data = {
          username: form.username.value,
          password: form.password.value
        };

        try {
          const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          const result = await res.json();

          if (res.ok) {
            localStorage.setItem('token', result.token);
            window.location.href = '/home';
          } else {
            errorMessage.textContent = result.error || 'Sai tài khoản hoặc mật khẩu!';
          }
        } catch (err) {
          errorMessage.textContent = 'Không thể kết nối tới server!';
        }
      });

      // Khi bấm nút Đăng ký → chuyển đến trang đăng ký
      signupBtn.addEventListener('click', () => {
        window.location.href = '/signup';
      });
